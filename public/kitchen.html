<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏´‡∏•‡∏±‡∏á‡∏£‡πâ‡∏≤‡∏ô - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    h1 { color: #4CAF50; }
    h3 { margin-bottom: 0; }
    hr { margin: 20px 0; }
    label { font-weight: bold; }
  </style>
</head>
<body>
  <h1>üìã ‡∏´‡∏•‡∏±‡∏á‡∏£‡πâ‡∏≤‡∏ô - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h1>

  <label for="soundUpload">üîä ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</label>
  <input type="file" id="soundUpload" accept="audio/*"><br><br>

  <div id="orders">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...</div>

  <script>
    let lastOrderTime = null;
    let customSound = null;

    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
    document.getElementById('soundUpload').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const fileURL = URL.createObjectURL(file);
        customSound = new Audio(fileURL);
        customSound.load();
      }
    });

    async function fetchOrders() {
      try {
        const res = await fetch('https://firestore.googleapis.com/v1/projects/nampanorder/databases/(default)/documents/orders');
        const data = await res.json();
        const ordersDiv = document.getElementById('orders');
        ordersDiv.innerHTML = '';

        if (data.documents) {
          const orders = data.documents.map((doc, index) => {
            const d = doc.fields;
            return {
              id: index + 1,
              name: d.name.stringValue,
              item: d.item.stringValue,
              sweet: d.sweet.stringValue,
              topping: d.topping?.stringValue || '-',
              note: d.note?.stringValue || '-',
              timestamp: d.timestamp.stringValue
            };
          }).reverse();

          orders.forEach(order => {
            const el = document.createElement('div');
            el.innerHTML = `
              <h3>#${order.id}</h3>
              <p>‡∏ä‡∏∑‡πà‡∏≠: ${order.name}</p>
              <p>‡πÄ‡∏°‡∏ô‡∏π: ${order.item}</p>
              <p>‡∏´‡∏ß‡∏≤‡∏ô: ${order.sweet}</p>
              <p>‡∏ó‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á: ${order.topping}</p>
              <p>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: ${order.note}</p>
              <p>‡πÄ‡∏ß‡∏•‡∏≤: ${order.timestamp}</p>
              <hr>
            `;
            ordersDiv.appendChild(el);
          });

          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
          const latestTimestamp = orders[0]?.timestamp;
          if (latestTimestamp !== lastOrderTime && lastOrderTime !== null) {
            if (customSound) customSound.play();
          }
          lastOrderTime = latestTimestamp;
        } else {
          ordersDiv.innerHTML = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤";
        }
      } catch (err) {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", err);
        document.getElementById('orders').innerText = "‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
      }
    }

    fetchOrders(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
    setInterval(fetchOrders, 3000); // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  </script>
</body>
</html>
