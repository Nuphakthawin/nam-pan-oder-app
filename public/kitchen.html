<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏´‡∏•‡∏±‡∏á‡∏£‡πâ‡∏≤‡∏ô - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      color: #e91e63;
    }
    .order {
      border: 1px solid #ccc;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      background-color: #fff8f9;
    }
    .order strong {
      display: inline-block;
      width: 120px;
    }
  </style>
</head>
<body>
  <h1>üì¶ ‡∏´‡∏•‡∏±‡∏á‡∏£‡πâ‡∏≤‡∏ô - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h1>

  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</label>
  <input type="file" id="sound-file" accept="audio/*"><br><br>

  <div id="orders"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      orderBy,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAsDV4gEEQZpJdK9sccKQLMG-vAEc9-KUc",
      authDomain: "nampanorder.firebaseapp.com",
      projectId: "nampanorder",
      storageBucket: "nampanorder.appspot.com",
      messagingSenderId: "123907265628",
      appId: "1:123907265628:web:b52fe97f50d4f97a57c299"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const ordersDiv = document.getElementById("orders");
    let latestOrderId = null;
    let customSound = null;

    document.getElementById('sound-file').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file) {
        customSound = new Audio(URL.createObjectURL(file));
        customSound.load();
        alert('‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      }
    });

    const q = query(collection(db, "orders"), orderBy("timestamp", "desc"));

    onSnapshot(q, (snapshot) => {
      ordersDiv.innerHTML = "";
      let count = 1;

      snapshot.forEach((doc) => {
        const order = doc.data();
        const time = order.timestamp?.seconds
          ? new Date(order.timestamp.seconds * 1000).toLocaleTimeString()
          : order.timestamp;

        const noteText = order.note?.trim() ? order.note : "-";
        const toppingText = order.topping?.trim() ? order.topping : "-";

        const div = document.createElement("div");
        div.className = "order";
        div.innerHTML = `
          <strong>#${count}</strong><br>
          <strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${order.name}<br>
          <strong>‡πÄ‡∏°‡∏ô‡∏π:</strong> ${order.item}<br>
          <strong>‡∏´‡∏ß‡∏≤‡∏ô:</strong> ${order.sweet}<br>
          <strong>‡∏ó‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á:</strong> ${toppingText}<br>
          <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</strong> ${noteText}<br>
          <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${time}
        `;
        ordersDiv.appendChild(div);
        count++;
      });

      // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà
      const newestId = snapshot.docs[0]?.id;
      if (latestOrderId && newestId !== latestOrderId && customSound) {
        customSound.play().catch(err => console.warn("‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err));
      }
      latestOrderId = newestId;
    });
  </script>
</body>
</html>
